<!-- vim: sw=4 ts=4 expandtab smartindent ft=javascript
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>demo</title>
    <style> document, body { margin: 0px; padding: 0px; overflow: hidden; } </style>
  </head>

  <body>
    <script>"use strict";
window.onload = () => {
    document.body.style.backgroundColor = 'white';// 'rgb(120, 140, 240)';

    const parent = document.createElement('div');
    parent.style.position = 'absolute';
    parent.style.width   = '100vw';
    parent.style.height  = '200vh';
    parent.style.top     = '-50vh';
    parent.style.display = 'flex';
    parent.style.flexWrap       = 'wrap';
    parent.style.flexDirection  = 'column';
    parent.style.alignContent   = 'center';
    parent.style.justifyContent = 'center';
    document.body.appendChild(parent);

    const divs = [];
    for (let i = 0; i < 9; i++) {
        const div = document.createElement('div');
        div.style.width  = '8vh';
        div.style.height = '8vh';
        div.style.margin = '0.8vh';
        div.style.backgroundColor = 'gray';// 'rgb(40, 80, 50)';

        div.style.display = 'flex';
        div.style.justifyContent = 'center';
        div.style.alignItems = 'center';

        div.style.fontSize = '4vh';
        div.textContent += "ðŸ¤”";

        parent.style.perspective = '500px';

        divs.push(div);
        parent.appendChild(div);
    }

    let mouse_x = 0, mouse_y = 0;
    window.onmousemove = ev => {
        mouse_x = ev.clientX;
        mouse_y = ev.clientY;
    };

    requestAnimationFrame(function frame() {
        requestAnimationFrame(frame);

        const center_y = window.innerHeight * 0.5;

        if (0) for (const d of divs) {
            const bcr = d.getBoundingClientRect();
            const x = bcr.x + bcr.width*0.5;
            const y = bcr.y + bcr.height*0.5;

            const dist = 0.1 * -Math.max(0, Math.abs(y - mouse_y) - 10);
            d.style.transform = `translateZ(${dist}px)`;
        }

        for (let i = 0; i < divs.length; i++) {
            const t = i / divs.length;
            const ANGLE_RANGE = Math.PI * 2;
            const angle = (t + Date.now()*0.000025) * ANGLE_RANGE;
            let y = Math.cos(angle);
            let z = Math.sin(angle);

            const perp_y = -z;
            const perp_z =  y;
            const tan_angle = -Math.atan2(perp_z, perp_y);

            y *= window.innerHeight*0.2;
            z *= window.innerHeight*0.2;
            divs[i].style.position = 'absolute';
            divs[i].style.top = (y + window.innerHeight) + 'px';
            divs[i].style.left = 'calc(' + window.innerWidth*0.5 + 'px - 4vh)';
            divs[i].style.transform = `translateZ(${-z}px) rotateX(${tan_angle}rad)`;
            divs[i].style.zIndex = -~~z;
        }
    });
}
    </script>
  </body>
</html>
